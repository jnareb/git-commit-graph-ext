<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.357">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Explore possible extensions to the serialized commit-graph format in Git, including adding reachability indexes for graph of revisions">

<title>git_commit_graph_ext - Commit graph labeling for speeding up Git commands</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="git_commit_graph_ext - Commit graph labeling for speeding up Git commands">
<meta property="og:description" content="Explore possible extensions to the serialized commit-graph format in Git, including adding reachability indexes for graph of revisions">
<meta property="og:site-name" content="git_commit_graph_ext">
<meta name="twitter:title" content="git_commit_graph_ext - Commit graph labeling for speeding up Git commands">
<meta name="twitter:description" content="Explore possible extensions to the serialized commit-graph format in Git, including adding reachability indexes for graph of revisions">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">git_commit_graph_ext</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">Commit graph labeling for speeding up Git commands</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Commit graph labeling for speeding up Git commands</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graphs in Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./related.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Related works: various reachability labelings</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Example directed graphs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reachability_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reachability index</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./levels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topological levels</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interval_labels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DFS Intervals Labelling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reach.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reachability queries</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extracting commit graphs from Git repositories</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./checkpoint.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checkpointing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graph datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Large Git repositories</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reachability evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a.09_git_explore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploring extraction of commit graphs from Git repositories, and examining their shape and stats</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#graph-operations-in-git" id="toc-graph-operations-in-git" class="nav-link active" data-scroll-target="#graph-operations-in-git">Graph operations in Git</a></li>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">Table of contents</a></li>
  <li><a href="#slides" id="toc-slides" class="nav-link" data-scroll-target="#slides">Slides</a></li>
  <li><a href="#todo-notebooks-to-split" id="toc-todo-notebooks-to-split" class="nav-link" data-scroll-target="#todo-notebooks-to-split">TODO: Notebooks to split</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jnareb/git-commit-graph-ext/tree/master/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Commit graph labeling for speeding up Git commands</h1>
</div>

<div>
  <div class="description">
    Explore possible extensions to the serialized commit-graph format in Git, including adding reachability indexes for graph of revisions
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>Git uses various clever methods for making operations on very large repositories faster, from bitmap indices for <code>git fetch</code>[<a href="https://githubengineering.com/counting-objects/" title="Counting Objects | The GitHub Blog">1</a>], to generation numbers (also known as topological levels) in the commit-graph file for commit graph traversal operations like <code>git log --graph</code>[<a href="https://devblogs.microsoft.com/devops/supercharging-the-git-commit-graph-iii-generations/" title="Supercharging the Git Commit Graph III: Generations and Graph Algorithms | Azure DevOps Blog">2</a>].</p>
<p>The goal of this project is to examine various possible improvements that can make Git even faster, other than just using generation numbers. For example there are many methods to make reachability queries in very large graphs faster; it remains to be seen if they would work on large commit graphs (the graph of project history) as well as they work on other real-life graphs.</p>
<p>Ultimately, this project is about examining extension to Git’s <a href="https://git-scm.com/docs/commit-graph">commit-graph</a> feature, including mainly adding reachability indexes / labels for the DAG (Directed Acyclic Graph) of revisions.</p>
<hr>
<p>This project, while mainly exploratory in nature, is using <a href="https://nbdev.fast.ai/" title="nbdev - Create delightful Python projects using Jupyter Notebooks"><code>nbdev</code></a> library for literate programming in Python using Jupyter Notebooks – not to create a Python module (to publish in PyPi and/or Conda), but to allow for splitting it up.</p>
<p>The original notebook at Google Colaboratory: “<a href="https://colab.research.google.com/drive/1V-U7_slu5Z3s5iEEMFKhLXtaxSu5xyzg" title="Reachability labels for version control graphs.ipynb | Colaboratory">Reachability labels for version control graphs.ipynb</a>” got quite unwieldy; it takes too much time to run it. By splitting it into smaller notebooks, and turning the code into helper modules, the hope is that it should be possible to quickly go to the interesting parts of exploration.</p>
<section id="graph-operations-in-git" class="level2">
<h2 class="anchored" data-anchor-id="graph-operations-in-git">Graph operations in Git</h2>
<p>This project focuses on the Git operations that involve examining and walking the commit graph, i.e.&nbsp;the project history. Such operations include:</p>
<ul>
<li><code>git merge-base --is-ancestor</code></li>
<li><code>git branch --contains</code></li>
<li><code>git tag --contains</code></li>
<li><code>git branch --merged</code></li>
<li><code>git tag --merged</code></li>
<li><code>git merge-base --all</code></li>
<li><code>git log --topo-sort</code></li>
</ul>
<p>Only the first command performs straight reachability query.</p>
</section>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of contents</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>this is not generated automatically</p>
</div>
</div>
<ol type="1">
<li><a href="./tools.html">Graphs in Python</a></li>
<li><a href="./related.html">Related works: various reachability labelings</a></li>
<li><a href="./example_graphs.html">Example directed graphs</a></li>
<li>Drawing graphs</li>
<li><a href="./reachability_index.html">Reachability index</a></li>
<li><a href="./levels.html">Topological levels</a></li>
<li><a href="./interval_labels.html">DFS intervals labelling</a></li>
<li><a href="./reach.html">Reachability queries</a></li>
<li><a href="./git.html">Extracting commit graphs from Git repositories</a>
<ul>
<li><a href="./a.09_git_explore.html">Exploring extraction of commit graphs from Git repositories, and examining their shape and stats</a></li>
</ul></li>
<li><a href="./checkpoint.html">Checkpointing</a></li>
<li><a href="./datasets.html">Graph datasets</a></li>
<li><a href="./repos.html">Large Git repositories</a></li>
<li>Graph stats</li>
<li><a href="./evaluation.html">Reachability evaluation</a></li>
</ol>
</section>
<section id="slides" class="level2">
<h2 class="anchored" data-anchor-id="slides">Slides</h2>
<p>This topic is covered in much more details in slides for the presentation “<a href="https://drive.google.com/open?id=1psMBVfcRHcZeJ7AewGpdoymrEfFVdXoK" title="Graph operations in Git version control system (PDF)"><em>Graph operations in Git version control system</em></a>” by Jakub Narebski (2019).</p>
<p>Those slides are also available to read on SlideShare and on Speaker Deck:</p>
<ul>
<li><a href="https://www.slideshare.net/JakubNarbski/graph-operations-in-git-version-control-system-how-the-performance-was-improved-for-large-repositories-how-can-it-be-further-improved" class="uri">https://www.slideshare.net/JakubNarbski/graph-operations-in-git-version-control-system-how-the-performance-was-improved-for-large-repositories-how-can-it-be-further-improved</a></li>
<li><a href="https://speakerdeck.com/jnareb/graph-operations-in-git-and-how-to-make-them-faster" class="uri">https://speakerdeck.com/jnareb/graph-operations-in-git-and-how-to-make-them-faster</a></li>
</ul>
</section>
<section id="todo-notebooks-to-split" class="level2">
<h2 class="anchored" data-anchor-id="todo-notebooks-to-split">TODO: Notebooks to split</h2>
<ul class="task-list">
<li><input type="checkbox"><a href="_Reachability_labels_for_version_control_graphs.ipynb">Reachability labels for version control graphs</a>
<ul class="task-list">
<li><input type="checkbox" checked="">graphs in Python</li>
<li><input type="checkbox" checked="">related work / references</li>
<li><input type="checkbox" checked="">example graphs</li>
<li><input type="checkbox" checked="">level filter</li>
<li><input type="checkbox" checked="">min-post intervals filter</li>
<li><input type="checkbox">pre-max version of intervals filter <em>(maybe)</em></li>
<li><input type="checkbox">FELINE filter <em>(maybe)</em></li>
<li><input type="checkbox">contraction hierarchy figure <em>(maybe)</em></li>
<li><input type="checkbox">helper functions (find_heads, etc.)</li>
<li><input type="checkbox" checked="">computing spanning tree</li>
<li><input type="checkbox">computing reach of a node</li>
<li><input type="checkbox" checked="">computing levels</li>
<li><input type="checkbox" checked="">computing min-post intervals</li>
<li><input type="checkbox">computing FELINE <em>(maybe)</em></li>
<li><input type="checkbox">testing quality [of FELINE]</li>
<li><input type="checkbox" checked="">reachability queries with levels and min-post</li>
<li><input type="checkbox">reachability queries with FELINE and PReaCH min-post <em>(maybe)</em></li>
<li><input type="checkbox">reachability query stats</li>
<li><input type="checkbox">post vs level graphs visualization</li>
<li><input type="checkbox">code for drawing graphs</li>
<li><input type="checkbox">interactive visualizations</li>
<li><input type="checkbox">version control graphs (LARGE)
<ul class="task-list">
<li><input type="checkbox" checked="">git in Python <em>(somewhat: shell vs GitPython)</em></li>
<li><input type="checkbox" checked="">cloning repository, generating graph of commits</li>
<li><input type="checkbox" checked="">saving data to file, restoring data from file</li>
<li><input type="checkbox" checked="">repositories to use: git, linux kernel</li>
<li><input type="checkbox">graph statistics</li>
<li><input type="checkbox">drawing a fragment of graph and whole graph (FELINE, min-post vs levels)</li>
<li><input type="checkbox">levels: histogram and histogram of distribution</li>
<li><input type="checkbox">levels as color in graph drawing</li>
<li><input type="checkbox">checking reachability between two commits</li>
<li><input type="checkbox">rev_to_node</li>
<li><input type="checkbox">interactive visualization</li>
<li><input type="checkbox">colorized walk drawing (positive-cut, negative-cut)</li>
<li><input type="checkbox">N^2 connectivity on [random sample of] commit graph nodes</li>
<li><input type="checkbox">connectivity on random pairs of nodes, statistics for reachability indexes</li>
<li><input type="checkbox">min-post range size and normalized size histogram</li>
</ul></li>
<li><input type="checkbox">graph datasets vs commit graphs</li>
</ul></li>
<li><input type="checkbox" checked=""><a href="_Reachability_queries_in_large_graphs.ipynb">Reachability queries in large graphs</a>
<ul class="task-list">
<li><input type="checkbox" checked="">datasets from FELINE</li>
<li><input type="checkbox" checked="">datasets from FERRARI</li>
<li><input type="checkbox" checked="">datasets from PReaCH</li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>